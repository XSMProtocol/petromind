<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetroMind ‚Äî Water Injection AI Tutor</title>
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #060d14;
            --surface: #0d1b2a;
            --surface2: #112236;
            --border: #1e3a5f;
            --accent: #00c8ff;
            --accent2: #0084ff;
            --gold: #f0a500;
            --text: #e8f4fd;
            --muted: #6b8fa8;
            --user-bubble: #0a2a4a;
            --ai-bubble: #0d1b2a;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Syne', sans-serif;
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            display: flex;
            overflow: hidden;
            background-image:
                radial-gradient(ellipse at 10% 0%, rgba(0,200,255,0.06) 0%, transparent 50%),
                radial-gradient(ellipse at 90% 100%, rgba(0,132,255,0.06) 0%, transparent 50%);
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 280px;
            min-width: 280px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 0;
            overflow-y: auto;
        }

        .logo-area {
            padding: 24px 20px 20px;
            border-bottom: 1px solid var(--border);
            background: linear-gradient(135deg, rgba(0,200,255,0.08), transparent);
        }

        .logo-area h1 {
            font-size: 1.6rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.02em;
        }

        .logo-area p {
            font-size: 0.72rem;
            color: var(--muted);
            font-family: 'JetBrains Mono', monospace;
            margin-top: 4px;
            letter-spacing: 0.05em;
        }

        .sections-label {
            padding: 16px 20px 8px;
            font-size: 0.65rem;
            font-family: 'JetBrains Mono', monospace;
            color: var(--muted);
            letter-spacing: 0.12em;
            text-transform: uppercase;
        }

        .section-btn {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            background: none;
            color: var(--text);
            text-align: left;
            width: 100%;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .section-btn:hover {
            background: rgba(0,200,255,0.05);
            border-left-color: rgba(0,200,255,0.3);
        }

        .section-btn.active {
            background: rgba(0,200,255,0.08);
            border-left-color: var(--accent);
        }

        .section-num {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            color: var(--accent);
            margin-top: 2px;
            min-width: 20px;
        }

        .section-title {
            font-size: 0.82rem;
            font-weight: 600;
            line-height: 1.3;
        }

        .quick-label {
            padding: 16px 20px 8px;
            font-size: 0.65rem;
            font-family: 'JetBrains Mono', monospace;
            color: var(--muted);
            letter-spacing: 0.12em;
            text-transform: uppercase;
            border-top: 1px solid var(--border);
            margin-top: 8px;
        }

        .quick-btn {
            display: block;
            width: calc(100% - 40px);
            margin: 4px 20px;
            padding: 8px 12px;
            background: rgba(0,200,255,0.05);
            border: 1px solid rgba(0,200,255,0.15);
            border-radius: 8px;
            color: var(--text);
            font-family: 'Syne', sans-serif;
            font-size: 0.75rem;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }

        .quick-btn:hover {
            background: rgba(0,200,255,0.12);
            border-color: var(--accent);
            transform: translateX(2px);
        }

        .sidebar-footer {
            margin-top: auto;
            padding: 16px 20px;
            border-top: 1px solid var(--border);
            font-size: 0.68rem;
            color: var(--muted);
            font-family: 'JetBrains Mono', monospace;
        }

        /* ===== MAIN CHAT ===== */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .top-bar {
            padding: 16px 28px;
            border-bottom: 1px solid var(--border);
            background: rgba(13,27,42,0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .top-bar-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text);
        }

        .top-bar-sub {
            font-size: 0.7rem;
            color: var(--muted);
            font-family: 'JetBrains Mono', monospace;
            margin-top: 2px;
        }

        .status-dot {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.72rem;
            color: var(--muted);
            font-family: 'JetBrains Mono', monospace;
        }

        .dot {
            width: 8px;
            height: 8px;
            background: #22c55e;
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(34,197,94,0.6);
            animation: pulse-dot 2s infinite;
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        /* ===== MESSAGES ===== */
        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 28px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            scrollbar-width: thin;
            scrollbar-color: var(--border) transparent;
        }

        .messages::-webkit-scrollbar { width: 4px; }
        .messages::-webkit-scrollbar-track { background: transparent; }
        .messages::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

        .welcome-card {
            background: linear-gradient(135deg, rgba(0,200,255,0.08), rgba(0,132,255,0.05));
            border: 1px solid rgba(0,200,255,0.2);
            border-radius: 16px;
            padding: 28px;
            margin-bottom: 8px;
        }

        .welcome-card h2 {
            font-size: 1.4rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .welcome-card p {
            font-size: 0.88rem;
            color: #a0bdd0;
            line-height: 1.6;
        }

        .welcome-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 16px;
        }

        .tag {
            padding: 4px 12px;
            background: rgba(0,200,255,0.1);
            border: 1px solid rgba(0,200,255,0.2);
            border-radius: 20px;
            font-size: 0.72rem;
            font-family: 'JetBrains Mono', monospace;
            color: var(--accent);
        }

        .msg {
            display: flex;
            gap: 12px;
            animation: fadeUp 0.3s ease-out;
        }

        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .msg.user { flex-direction: row-reverse; }

        .msg-avatar {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: 700;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .msg.ai .msg-avatar {
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            color: #060d14;
        }

        .msg.user .msg-avatar {
            background: var(--surface2);
            border: 1px solid var(--border);
            color: var(--accent);
        }

        .msg-bubble {
            max-width: 72%;
            padding: 14px 18px;
            border-radius: 14px;
            font-size: 0.88rem;
            line-height: 1.7;
        }

        .msg.ai .msg-bubble {
            background: var(--ai-bubble);
            border: 1px solid var(--border);
            border-top-left-radius: 4px;
        }

        .msg.user .msg-bubble {
            background: var(--user-bubble);
            border: 1px solid rgba(0,200,255,0.2);
            border-top-right-radius: 4px;
            text-align: right;
        }

        .msg-bubble strong { color: var(--accent); }
        .msg-bubble em { color: var(--gold); font-style: normal; font-weight: 600; }

        .msg-bubble ul { padding-left: 18px; margin: 8px 0; }
        .msg-bubble ul li { margin: 4px 0; }
        .msg-bubble h3 { color: var(--accent); margin: 10px 0 6px; font-size: 0.9rem; }

        .typing-indicator {
            display: flex;
            gap: 4px;
            align-items: center;
            padding: 14px 18px;
        }

        .typing-indicator span {
            width: 6px;
            height: 6px;
            background: var(--accent);
            border-radius: 50%;
            animation: bounce 1.2s infinite;
            opacity: 0.6;
        }

        .typing-indicator span:nth-child(2) { animation-delay: 0.15s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.3s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: translateY(0); opacity: 0.4; }
            40% { transform: translateY(-6px); opacity: 1; }
        }

        /* ===== INPUT AREA ===== */
        .input-area {
            padding: 20px 28px;
            border-top: 1px solid var(--border);
            background: rgba(6,13,20,0.9);
        }

        .input-wrap {
            display: flex;
            gap: 12px;
            align-items: flex-end;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 12px 16px;
            transition: border-color 0.2s;
        }

        .input-wrap:focus-within {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(0,200,255,0.1);
        }

        #user-input {
            flex: 1;
            background: none;
            border: none;
            outline: none;
            color: var(--text);
            font-family: 'Syne', sans-serif;
            font-size: 0.88rem;
            resize: none;
            max-height: 140px;
            line-height: 1.5;
        }

        #user-input::placeholder { color: var(--muted); }

        #send-btn {
            width: 38px;
            height: 38px;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s;
        }

        #send-btn:hover { transform: scale(1.05); filter: brightness(1.1); }
        #send-btn:active { transform: scale(0.96); }
        #send-btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; }

        #send-btn svg { width: 16px; height: 16px; fill: #060d14; }

        .input-hint {
            font-size: 0.68rem;
            color: var(--muted);
            font-family: 'JetBrains Mono', monospace;
            margin-top: 8px;
            padding-left: 4px;
        }

        /* ===== MOBILE ===== */
        @media (max-width: 768px) {
            .sidebar { display: none; }
        }
    </style>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar">
    <div class="logo-area">
        <h1>‚õΩ PetroMind</h1>
        <p>// Water Injection AI Tutor</p>
    </div>

    <div class="sections-label">üìö Module Sections</div>

    <button class="section-btn active" onclick="setSection(0)">
        <span class="section-num">01</span>
        <span class="section-title">Reservoir Rocks & Water Injection Basics</span>
    </button>
    <button class="section-btn" onclick="setSection(1)">
        <span class="section-num">02</span>
        <span class="section-title">Water Injection Systems & Equipment</span>
    </button>
    <button class="section-btn" onclick="setSection(2)">
        <span class="section-num">03</span>
        <span class="section-title">Water Treatment & Quality Control</span>
    </button>
    <button class="section-btn" onclick="setSection(3)">
        <span class="section-num">04</span>
        <span class="section-title">Operations, Monitoring & Troubleshooting</span>
    </button>

    <div class="quick-label">‚ö° Quick Actions</div>
    <button class="quick-btn" onclick="quickAsk('Give me a summary of this section')">üìã Section Summary</button>
    <button class="quick-btn" onclick="quickAsk('Give me 5 exam-style questions with answers')">üìù Practice Quiz</button>
    <button class="quick-btn" onclick="quickAsk('Explain the key formulas and equations in this section')">üßÆ Key Formulas</button>
    <button class="quick-btn" onclick="quickAsk('What are the most common mistakes students make in this topic?')">‚ö†Ô∏è Common Mistakes</button>
    <button class="quick-btn" onclick="quickAsk('Give me real-world examples from the oil industry')">üè≠ Industry Examples</button>

    <div class="quick-label" style="margin-top: 20px;">üéì Study Mode</div>
    <button class="section-btn" style="margin-top: 4px; border-left-color: rgba(240,165,0,0.3);" onclick="setGeneralMode()" id="general-mode-btn">
        <span class="section-num" style="color: var(--gold);">‚àû</span>
        <span class="section-title">General Study Assistant</span>
    </button>

    <div class="sidebar-footer">
        Petroleum Processing Technology<br>
        Abu Dhabi Polytechnic<br>
        <div style="margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border); font-size: 0.65rem; color: var(--accent);">
            Developed by <strong>0xCC</strong>
        </div>
    </div>
</div>

<!-- MAIN -->
<div class="main">
    <div class="top-bar">
        <div>
            <div class="top-bar-title" id="current-section-title">Section 1 ‚Äî Reservoir Rocks & Water Injection</div>
            <div class="top-bar-sub">Ask anything about Water Injection module</div>
        </div>
        <div class="status-dot">
            <div class="dot"></div>
            AI Online
        </div>
    </div>

    <div class="messages" id="messages">
        <div class="welcome-card">
            <h2>Welcome to PetroMind üî¨</h2>
            <p>Your specialized AI tutor for the <strong>Water Injection</strong> module. Ask me anything ‚Äî explanations, quizzes, formulas, or real-world examples. I'm here to help you master this subject.</p>
            <div class="welcome-tags">
                <span class="tag">Reservoir Rocks</span>
                <span class="tag">Porosity & Permeability</span>
                <span class="tag">Drive Mechanisms</span>
                <span class="tag">Injection Systems</span>
                <span class="tag">Water Treatment</span>
                <span class="tag" style="background: rgba(0,200,255,0.05); border-color: rgba(0,200,255,0.15);">by 0xCC</span>
            </div>
        </div>
    </div>

    <div class="input-area">
        <div class="input-wrap">
            <textarea
                id="user-input"
                placeholder="Ask about Water Injection... (Enter to send)"
                rows="1"
                onkeydown="handleKey(event)"
                oninput="autoResize(this)"
            ></textarea>
            <button id="send-btn" onclick="sendMessage()" title="Send">
                <svg viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2z"/></svg>
            </button>
        </div>
        <div class="input-hint">Enter ‚Üµ to send ¬∑ Shift+Enter for new line</div>
    </div>
</div>

<script>
    // =============================================
    // üîë BACKEND API ENDPOINT
    // Replace with your Cloudflare Worker URL after deployment
    // Example: https://petromind-backend.your-username.workers.dev
    // =============================================
    const BACKEND_API = "https://petromind-backend.YOUR_USERNAME.workers.dev";
    // =============================================

    const SECTIONS = [
        {
            title: "Section 1 ‚Äî Reservoir Rocks & Water Injection",
            context: "Section 1: Reservoir basics including types of reservoir rocks (sandstone, limestone, dolomite), porosity and permeability concepts, natural drive mechanisms (water drive, gas cap drive, solution gas drive, gravity drainage, combination drive), decline in reservoir pressure, and why water injection is used for pressure maintenance and improved oil recovery (IOR/EOR)."
        },
        {
            title: "Section 2 ‚Äî Water Injection Systems & Equipment",
            context: "Section 2: Water injection surface facilities including injection pumps (centrifugal and reciprocating), wellhead equipment, injection lines, manifolds, flowlines, control valves, injection wellheads, and the overall surface injection system design and layout."
        },
        {
            title: "Section 3 ‚Äî Water Treatment & Quality Control",
            context: "Section 3: Water sources for injection (seawater, produced water, aquifer water), water treatment processes including filtration, deoxygenation, biocide treatment, scale inhibition, corrosion inhibition, water quality standards (suspended solids, oxygen content, bacteria counts, compatibility testing), and water analysis."
        },
        {
            title: "Section 4 ‚Äî Operations, Monitoring & Troubleshooting",
            context: "Section 4: Day-to-day water injection operations, injection profiles, well testing, injectivity testing, pressure monitoring, production response monitoring, common problems (injectivity decline, scale, corrosion, bacteria), troubleshooting methods, and surveillance programs."
        }
    ];

    let currentSection = 0;
    let isLoading = false;
    let conversationHistory = [];
    let isGeneralMode = false;

    function setSection(idx) {
        currentSection = idx;
        isGeneralMode = false;
        conversationHistory = [];

        document.querySelectorAll('.section-btn').forEach((btn, i) => {
            btn.classList.toggle('active', i === idx);
        });
        document.getElementById('general-mode-btn').classList.remove('active');

        document.getElementById('current-section-title').textContent = SECTIONS[idx].title;

        const messagesEl = document.getElementById('messages');
        messagesEl.innerHTML = `
            <div class="welcome-card">
                <h2>üìñ ${SECTIONS[idx].title}</h2>
                <p>You're now studying <strong>Section ${idx + 1}</strong>. Ask me anything about this section ‚Äî explanations, quizzes, formulas, or key concepts.</p>
                <div class="welcome-tags">
                    <span class="tag">Section ${idx + 1} Active</span>
                    <span class="tag">AI Tutor Ready</span>
                    <span class="tag" style="background: rgba(0,200,255,0.05); border-color: rgba(0,200,255,0.15);">by 0xCC</span>
                </div>
            </div>
        `;
    }

    function setGeneralMode() {
        isGeneralMode = true;
        conversationHistory = [];

        document.querySelectorAll('.section-btn').forEach(btn => {
            btn.classList.remove('active');
        });
        document.getElementById('general-mode-btn').classList.add('active');

        document.getElementById('current-section-title').textContent = "General Study Assistant";

        const messagesEl = document.getElementById('messages');
        messagesEl.innerHTML = `
            <div class="welcome-card" style="background: linear-gradient(135deg, rgba(240,165,0,0.08), rgba(240,165,0,0.05)); border-color: rgba(240,165,0,0.2);">
                <h2 style="background: linear-gradient(135deg, var(--gold), #ff8c00); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">üéì General Study Assistant</h2>
                <p>Ask me anything about your university subjects ‚Äî Math, Physics, Thermodynamics, Chemistry, Engineering courses, and more. I'll explain everything in detail!</p>
                <div class="welcome-tags">
                    <span class="tag" style="background: rgba(240,165,0,0.1); border-color: rgba(240,165,0,0.2); color: var(--gold);">All Subjects</span>
                    <span class="tag" style="background: rgba(240,165,0,0.1); border-color: rgba(240,165,0,0.2); color: var(--gold);">Detailed Explanations</span>
                    <span class="tag" style="background: rgba(240,165,0,0.1); border-color: rgba(240,165,0,0.2); color: var(--gold);">by 0xCC</span>
                </div>
            </div>
        `;
    }

    function quickAsk(question) {
        document.getElementById('user-input').value = question;
        sendMessage();
    }

    function handleKey(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    }

    function autoResize(el) {
        el.style.height = 'auto';
        el.style.height = Math.min(el.scrollHeight, 140) + 'px';
    }

    function appendMessage(role, content) {
        const messagesEl = document.getElementById('messages');
        const div = document.createElement('div');
        div.className = `msg ${role}`;

        const avatar = role === 'ai' ? '‚õΩ' : 'ME';
        const formattedContent = formatContent(content);

        div.innerHTML = `
            <div class="msg-avatar">${avatar}</div>
            <div class="msg-bubble">${formattedContent}</div>
        `;

        messagesEl.appendChild(div);
        messagesEl.scrollTop = messagesEl.scrollHeight;
        return div;
    }

    function formatContent(text) {
        return text
            .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
            .replace(/\*(.*?)\*/g, '<em>$1</em>')
            .replace(/^### (.+)$/gm, '<h3>$1</h3>')
            .replace(/^## (.+)$/gm, '<h3>$1</h3>')
            .replace(/^# (.+)$/gm, '<h3>$1</h3>')
            .replace(/^- (.+)$/gm, '<li>$1</li>')
            .replace(/(<li>.*<\/li>)/gs, (match) => `<ul>${match}</ul>`)
            .replace(/\n\n/g, '</p><p>')
            .replace(/\n/g, '<br>');
    }

    function showTyping() {
        const messagesEl = document.getElementById('messages');
        const div = document.createElement('div');
        div.className = 'msg ai';
        div.id = 'typing';
        div.innerHTML = `
            <div class="msg-avatar">‚õΩ</div>
            <div class="msg-bubble">
                <div class="typing-indicator">
                    <span></span><span></span><span></span>
                </div>
            </div>
        `;
        messagesEl.appendChild(div);
        messagesEl.scrollTop = messagesEl.scrollHeight;
    }

    function removeTyping() {
        const typing = document.getElementById('typing');
        if (typing) typing.remove();
    }

    async function typeWriter(element, text, speed = 15) {
        const formattedText = formatContent(text);
        element.innerHTML = '';
        
        // Create a temporary div to parse the HTML
        const temp = document.createElement('div');
        temp.innerHTML = formattedText;
        
        // Get text content for typing
        const plainText = text;
        let displayText = '';
        
        for (let i = 0; i < plainText.length; i++) {
            displayText += plainText[i];
            element.innerHTML = formatContent(displayText);
            
            // Scroll to bottom as text appears
            const messagesEl = document.getElementById('messages');
            messagesEl.scrollTop = messagesEl.scrollHeight;
            
            // Wait before next character
            await new Promise(resolve => setTimeout(resolve, speed));
        }
        
        // Final formatted version
        element.innerHTML = formattedText;
    }

    async function sendMessage() {
        const input = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const text = input.value.trim();

        if (!text || isLoading) return;

        if (BACKEND_API.includes("YOUR_USERNAME")) {
            appendMessage('ai', '‚ö†Ô∏è **Backend Not Configured**\n\nPlease update the `BACKEND_API` variable with your Cloudflare Worker URL.');
            return;
        }

        input.value = '';
        input.style.height = 'auto';
        isLoading = true;
        sendBtn.disabled = true;

        appendMessage('user', text);
        conversationHistory.push({ role: 'user', content: text });

        showTyping();

        const systemPrompt = isGeneralMode ? 
            `You are a helpful, detailed university study assistant for engineering students at Abu Dhabi Polytechnic. You were developed by 0xCC.

You help with ALL university subjects including:
- Mathematics (Calculus, Linear Algebra, Differential Equations, etc.)
- Physics (Mechanics, Thermodynamics, Electromagnetism, etc.)
- Chemistry (General, Organic, Physical Chemistry)
- Engineering courses (Chemical Engineering, Mechanical, Petroleum, etc.)
- Any other university subject

If someone asks who created you or who developed you, say: "I was developed by 0xCC, a talented developer who created this tool to help students study better."

Teaching style:
- Give EXTREMELY DETAILED explanations - don't hold back on depth
- Break down complex concepts step-by-step
- Use examples, analogies, and visual descriptions
- For math problems: show every step of the solution
- For concepts: explain the "why" behind everything
- Use **bold** for key terms and *italics* for important values
- Include practice problems when relevant
- Be encouraging and patient
- If the student seems confused, explain in multiple ways

Your goal is to help the student truly understand, not just memorize.`
            :
            `You are PetroMind, a specialized AI tutor for the Water Injection module in Petroleum Processing Technology at Abu Dhabi Polytechnic. You were developed by 0xCC.

You ONLY answer questions related to Water Injection and petroleum engineering topics covered in this module. If someone asks about unrelated topics, politely decline and redirect them to water injection topics.

If someone asks who created you or who developed you, say: "I was developed by 0xCC, a talented developer who created this specialized tool for Water Injection studies."

Current section the student is studying:
${SECTIONS[currentSection].context}

Teaching style:
- Clear, structured explanations suitable for engineering students
- Use bullet points, numbered lists, and headers when helpful
- Include practical examples from the oil industry
- For formulas, explain each variable clearly
- Be encouraging and supportive
- Keep answers focused and educational
- Use **bold** for key terms and *italics* for important values/numbers`;

        try {
            const response = await fetch(BACKEND_API, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: 'claude-sonnet-4-20250514',
                    max_tokens: 1500,
                    system: systemPrompt,
                    messages: conversationHistory
                })
            });

            if (!response.ok) {
                const err = await response.json();
                throw new Error(err.error?.message || `HTTP ${response.status}`);
            }

            const data = await response.json();
            const aiReply = data.content[0].text;

            removeTyping();
            
            // Animate typing effect
            const msgDiv = appendMessage('ai', '');
            const bubble = msgDiv.querySelector('.msg-bubble');
            await typeWriter(bubble, aiReply, 15); // 15ms per character
            
            conversationHistory.push({ role: 'assistant', content: aiReply });

        } catch (error) {
            removeTyping();
            appendMessage('ai', `‚ùå **Error:** ${error.message}\n\nCheck your backend configuration and try again.`);
            conversationHistory.pop();
        }

        isLoading = false;
        sendBtn.disabled = false;
        input.focus();
    }
</script>

</body>
</html>
